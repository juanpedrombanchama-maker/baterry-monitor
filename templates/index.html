<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Monitor de Bater√≠as</title>
  <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
  <style>
    body {
      font-family: Arial, sans-serif;
      background-color: #f0f0f0;
      text-align: center;
      padding: 40px;
    }

    .bateria-container {
      width: 200px;
      height: 100px;
      border: 4px solid #333;
      border-radius: 8px;
      margin: 20px auto;
      position: relative;
      background-color: #ddd;
      overflow: hidden;
    }

    .bateria-nivel {
      box-shadow: inset 0 0 5px rgba(0,0,0,0.3);
      height: 100%;
      width: 0%;
      transition: width 0.5s ease;
    }

    .bateria-tapita {
      width: 20px;
      height: 40px;
      background-color: #333;
      position: absolute;
      top: 30px;
      right: -24px;
      border-radius: 4px;
    }

    .texto {
      font-size: 20px;
      margin-top: 10px;
    }
  </style>
</head>
<body>
  <h1>üîã Estado de las Bater√≠as</h1>
  <div id="contenedor-baterias"></div>

  <script>
    function actualizar() {
      fetch('/nivel')
        .then(res => res.json())
        .then(data => {
          const contenedor = document.getElementById('contenedor-baterias');
          contenedor.innerHTML = '';

          const ids = Object.keys(data);
          if (ids.length === 0) {
            contenedor.innerHTML = '<p style="font-size: 20px; color: #666;">‚ö†Ô∏è No hay bater√≠as conectadas</p>';
            return;
          }

          for (const [id, datos] of Object.entries(data)) {
            const porcentaje = parseFloat(datos.porcentaje.toFixed(1));
            const voltaje = datos.voltaje.toFixed(2);

            const color = porcentaje > 75 ? '#4caf50' :
                          porcentaje > 40 ? '#ffeb3b' : '#f44336';

            const fondo = voltaje < 3.3 || voltaje > 4.2 ? '#ffe6e6' : '#f0f0f0';

            const alerta = porcentaje < 20 ? '<p style="color:#f44336;">‚ö†Ô∏è Bater√≠a baja</p>' : '';

            const bateriaHTML = `
              <div class="bateria-container" style="background-color: ${fondo};">
                <div class="bateria-nivel" style="width: ${porcentaje}%; background-color: ${color}; transition: width 0.5s ease;"></div>
                <div class="bateria-tapita"></div>
              </div>
              <div class="texto" style="color: ${porcentaje < 20 ? '#f44336' : '#333'};">
                <strong>${id}</strong>: ${porcentaje}% (${voltaje} V)
                ${alerta}
              </div>
            `;

            contenedor.innerHTML += bateriaHTML;
          }
        })
        .catch(err => {
          document.getElementById('contenedor-baterias').innerHTML = '<p>Error al obtener datos</p>';
        });
    }

    setInterval(actualizar, 1000);
  </script>
</body>
</html>
